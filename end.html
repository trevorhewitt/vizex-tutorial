<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no"/>
  <title>XX — Template</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <style>
    .page { max-width: 900px; margin: 0 auto; padding: 24px; }
    .wait-wrap { margin-top:16px; }
    .footer { position: fixed; left: 0; right: 0; bottom: 0; padding: 12px 16px; }
    .button-bar { display: flex; gap: 12px; justify-content: space-between; }
  </style>
</head>
<script>
(function () {
  // Config
  const REQUIRED_WAITS = 3;
  const WINDOW_MS = 8000;     // complete the sequence within 8s
  const AFTER_ARM_MS = 4000;  // header click within 4s after the 3rd "Wait"

  // Find targets without changing the DOM/appearance
  const waitButtons = Array.from(document.querySelectorAll('button, a, [role="button"]'))
    .filter(el => (el.textContent || '').trim().toLowerCase() === 'wait');
  const headerEl = document.querySelector('h1, header h1, .header h1');

  if (!headerEl || waitButtons.length === 0) return; // If your page doesn't have them, do nothing

  let count = 0;
  let windowTimer = null;
  let armed = false;
  let armedTimer = null;

  function resetAll() {
    count = 0;
    armed = false;
    if (windowTimer) { clearTimeout(windowTimer); windowTimer = null; }
    if (armedTimer)  { clearTimeout(armedTimer);  armedTimer  = null; }
  }

  function startWindowTimer() {
    if (windowTimer) clearTimeout(windowTimer);
    windowTimer = setTimeout(resetAll, WINDOW_MS);
  }

  function onWaitClick() {
    // Start/reset the overall window
    if (count === 0) startWindowTimer();

    count += 1;

    if (count >= REQUIRED_WAITS) {
      // Arm the header step
      armed = true;
      if (armedTimer) clearTimeout(armedTimer);
      armedTimer = setTimeout(resetAll, AFTER_ARM_MS);
    }
  }

  function onHeaderClick() {
    if (!armed) return;
    // Success — go to the tutorial root with NO query params
    // Compute base like: https://…/vizex-tutorial/
    const basePath = location.pathname.endsWith('/') ? location.pathname : location.pathname.replace(/[^/]+$/, '');
    const target = location.origin + basePath;
    // Hard reset (no history params lingering)
    location.replace(target);
  }

  waitButtons.forEach(btn => btn.addEventListener('click', onWaitClick, { passive: true }));
  headerEl.addEventListener('click', onHeaderClick, { passive: true });
})();
</script>
<body data-page="xx-template">
    <div class="page">
    <div class="content">
        <div class="inner">
        <h1>You have now completed the practice trials. </h1>
        <p>Well done</p>

        <div class="wait-wrap" style="margin-top:16px;">
            <h1>WAIT</h1>
        </div>
        <p>Please wait a moment for the rest of the participants to finish as well.</p>
        </div>
    </div>
    </div>
  <div class="footer">
    <div class="button-bar">
      <button id="backBtn" class="secondary">Back</button>
      <button id="nextBtn" class="primary">Next</button>
    </div>
  </div>

  <script>
    // ============================
    // EDIT THESE THREE CONSTANTS:
    // ============================
    // Set where Next and Back should go (filenames in the same folder).
    // Always pass along the query params automatically (handled below).
    const NEXT_PAGE = "XX_set_next.html";
    const BACK_PAGE = "XX_set_back.html";
    // Set to true to hide the Back button on THIS page.
    // ============================

    // --- Shared helpers (inline, no external deps) ---
    function parseQuery() {
      const q = new URLSearchParams(location.search);
      return Object.fromEntries(q.entries());
    }
    function baseQueryString() {
      const { p, n, m } = parseQuery();
      const q = new URLSearchParams();
      if (p) q.set("p", p);
      if (n) q.set("n", n);
      q.set("m", (m === "1" ? "1" : "0"));
      return "?" + q.toString();
    }

    (function init() {
      // Hide buttons
      document.getElementById("backBtn").style.visibility = "hidden";
      document.getElementById("nextBtn").style.visibility = "hidden";

      document.getElementById("nextBtn").addEventListener("click", () => {
        if (!NEXT_PAGE) return;
        location.href = NEXT_PAGE + baseQueryString();
      });

      document.getElementById("backBtn").addEventListener("click", () => {
        if (!BACK_PAGE) return;
        location.href = BACK_PAGE + baseQueryString();
      });
    })();
  </script>
</body>
</html>
